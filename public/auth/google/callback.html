<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>구글 로그인 처리 중...</title>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f5f5f5;
      }
      .container {
        text-align: center;
        padding: 20px;
      }
      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #E60A34;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .message {
        color: #333;
        font-size: 16px;
        margin-bottom: 10px;
      }
      .sub-message {
        color: #666;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="spinner"></div>
      <div class="message">구글 로그인 처리 중...</div>
      <div class="sub-message">잠시 후 앱으로 이동합니다.</div>
    </div>

    <script>
      // URL에서 파라미터 추출
      const urlParams = new URLSearchParams(window.location.search);
      const code = urlParams.get("code");
      const state = urlParams.get("state");
      const error = urlParams.get("error");

      // 앱 열기 시도 (유니버셜 링크 → 딥링크 폴백)
      function redirectToApp() {
        const universalLink = `https://seo-haeng-fe.vercel.app/auth/google/callback?code=${encodeURIComponent(code)}&state=${encodeURIComponent(state || "")}`;
        const deepLink = `seohaeng://auth/google/callback?code=${encodeURIComponent(code)}&state=${encodeURIComponent(state || "")}`;
        
        // 페이지 상태 업데이트
        document.querySelector(".message").textContent = "앱 열기 시도 중...";
        document.querySelector(".sub-message").textContent = "유니버셜 링크로 시도합니다.";
        
        // 1차 시도: 유니버셜 링크
        window.location.href = universalLink;
        
        // 2초 후 유니버셜 링크 실패 시 딥링크 시도
        setTimeout(() => {
          document.querySelector(".sub-message").textContent = "딥링크로 시도합니다.";
          window.location.href = deepLink;
          
          // 3초 후 사용자에게 안내
          setTimeout(() => {
            document.querySelector(".message").textContent = "앱으로 이동 중...";
            document.querySelector(".sub-message").innerHTML = 
              `브라우저를 닫고 앱을 열어주세요. 로그인이 완료됩니다.<br>
               <a href="${universalLink}" style="color: #E60A34; text-decoration: underline;">유니버셜 링크 직접 클릭</a> | 
               <a href="${deepLink}" style="color: #E60A34; text-decoration: underline;">딥링크 직접 클릭</a>`;
          }, 1000);
        }, 2000);
      }

      // 에러 처리
      if (error) {
        document.querySelector(".message").textContent = "❌ 구글 로그인 오류 발생";
        document.querySelector(".sub-message").textContent = `오류: ${error}. 잠시 후 다시 시도해주세요.`;
      } else if (!code) {
        document.querySelector(".message").textContent = "❌ 인증 코드 없음";
        document.querySelector(".sub-message").textContent = "구글에서 인증 코드를 받지 못했습니다. 다시 시도해주세요.";
      } else {
        // 성공적으로 코드를 받았을 때
        document.querySelector(".message").textContent = "✅ 구글 로그인 성공";
        document.querySelector(".sub-message").textContent = "인증 코드를 받았습니다. 앱으로 이동합니다...";
        
        // 페이지 로드 후 즉시 리다이렉트 시도
        setTimeout(redirectToApp, 500);
      }
    </script>
  </body>
</html>
